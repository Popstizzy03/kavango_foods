---
import PaymentButton from './PaymentButton.astro';
---

<div class="bg-white p-8 rounded-xl shadow-md mb-6">
  <h2 class="text-2xl font-semibold mb-6">Delivery Information</h2>
  
  <form id="delivery-form" class="space-y-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label for="name" class="block text-text-light mb-2">Full Name</label>
        <input 
          type="text" 
          id="name" 
          name="name" 
          required 
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="Your name"
        >
      </div>
      
      <div>
        <label for="phone" class="block text-text-light mb-2">Phone Number</label>
        <input 
          type="tel" 
          id="phone" 
          name="phone" 
          required 
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="Your phone number"
        >
      </div>
    </div>
    
    <div>
      <label for="address" class="block text-text-light mb-2">Delivery Address</label>
      <textarea 
        id="address" 
        name="address" 
        required 
        rows="3" 
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
        placeholder="Your delivery address"
      ></textarea>
    </div>
    
    <div>
      <label for="notes" class="block text-text-light mb-2">Order Notes (Optional)</label>
      <textarea 
        id="notes" 
        name="notes" 
        rows="2" 
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
        placeholder="Any special instructions"
      ></textarea>
    </div>
    
    <div class="border-t pt-6">
      <h3 class="text-xl font-semibold mb-4">Payment Method</h3>
      <div class="flex flex-col space-y-4">
        <PaymentButton />
      </div>
    </div>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const deliveryForm = document.getElementById('delivery-form');
    const nameInput = document.getElementById('name');
    const phoneInput = document.getElementById('phone');
    const addressInput = document.getElementById('address');
    const notesInput = document.getElementById('notes');
    
    // Form validation
    deliveryForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      // Basic validation
      if (!nameInput.value.trim()) {
        showToast('Please enter your name', 'error');
        return;
      }
      
      if (!phoneInput.value.trim()) {
        showToast('Please enter your phone number', 'error');
        return;
      }
      
      if (!addressInput.value.trim()) {
        showToast('Please enter your delivery address', 'error');
        return;
      }
      
      // Store delivery info in localStorage
      const deliveryInfo = {
        name: nameInput.value.trim(),
        phone: phoneInput.value.trim(),
        address: addressInput.value.trim(),
        notes: notesInput.value.trim()
      };
      
      localStorage.setItem('deliveryInfo', JSON.stringify(deliveryInfo));
      
      // Continue with payment
      // This will be handled by the PaymentButton component
    });
    
    // Helper function to show toast
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      
      // Set toast content and style based on type
      toast.textContent = message;
      toast.className = 'fixed bottom-4 right-4 px-4 py-3 rounded-lg shadow-lg z-50';
      
      if (type === 'error') {
        toast.classList.add('bg-red-500', 'text-white');
      } else {
        toast.classList.add('bg-green-500', 'text-white');
      }
      
      // Show toast
      toast.classList.remove('hidden');
      
      // Hide toast after 3 seconds
      setTimeout(() => {
        toast.classList.add('hidden');
      }, 3000);
    }
  });
  </script>